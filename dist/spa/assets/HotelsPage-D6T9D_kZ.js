import{Q as Z}from"./QSelect-HrLhbk6i.js";import{Q as F}from"./QInput-CAHg_qN-.js";import{Q as p,a as ee}from"./QImg-Dhvk776f.js";import{c as le,S as te,g as oe,T as ae,r as g,a as V,U as ne,h as O,d as ie,Q as E,V as z,C as re,D as H,E as c,F as se,N as a,H as r,K as j,f as k,L as U,O as J,M as ue,P as ce,J as u,I as f,v as G}from"./index-DwtXEeEE.js";import{Q as de,a as P,b as I}from"./QPage-BKmakszr.js";import{u as me,b as ve,a as fe}from"./use-key-composition-ByB1cnyR.js";import{b as ge}from"./format-DYNuBcB2.js";import{Q as T}from"./QCardActions-C7c0BvX-.js";import{Q as W}from"./QDialog-1wfPclpf.js";import{C as X}from"./ClosePopup-CijrAyJj.js";import{b as ye}from"./main-CmGCYb36.js";import{u as be}from"./use-quasar-ChbBNSRg.js";import{s as xe}from"./pinia-DeEn6jnt.js";import"./QChip-BlzJDsgu.js";import"./QItem-Cav7HXzn.js";import"./focus-manager-BJWzFvJg.js";import"./TouchPan-Cxkih3Ys.js";import"./use-prevent-scroll-dlfsZIDd.js";import"./use-id-DNP9DObu.js";const he=le({name:"QRating",props:{...te,...me,modelValue:{type:Number,required:!0},max:{type:[String,Number],default:5},icon:[String,Array],iconHalf:[String,Array],iconSelected:[String,Array],iconAriaLabel:[String,Array],color:[String,Array],colorHalf:[String,Array],colorSelected:[String,Array],noReset:Boolean,noDimming:Boolean,readonly:Boolean,disable:Boolean},emits:["update:modelValue"],setup(e,{slots:$,emit:Q}){const{proxy:{$q:q}}=oe(),N=ae(e),R=ve(e),_=fe(R),s=g(0);let d={};const y=V(()=>e.readonly!==!0&&e.disable!==!0),S=V(()=>`q-rating row inline items-center q-rating--${y.value===!0?"":"non-"}editable`+(e.noDimming===!0?" q-rating--no-dimming":"")+(e.disable===!0?" disabled":"")+(e.color!==void 0&&Array.isArray(e.color)===!1?` text-${e.color}`:"")),C=V(()=>{const n=Array.isArray(e.icon)===!0?e.icon.length:0,o=Array.isArray(e.iconSelected)===!0?e.iconSelected.length:0,v=Array.isArray(e.iconHalf)===!0?e.iconHalf.length:0,b=Array.isArray(e.color)===!0?e.color.length:0,x=Array.isArray(e.colorSelected)===!0?e.colorSelected.length:0,t=Array.isArray(e.colorHalf)===!0?e.colorHalf.length:0;return{iconLen:n,icon:n>0?e.icon[n-1]:e.icon,selIconLen:o,selIcon:o>0?e.iconSelected[o-1]:e.iconSelected,halfIconLen:v,halfIcon:v>0?e.iconHalf[o-1]:e.iconHalf,colorLen:b,color:b>0?e.color[b-1]:e.color,selColorLen:x,selColor:x>0?e.colorSelected[x-1]:e.colorSelected,halfColorLen:t,halfColor:t>0?e.colorHalf[t-1]:e.colorHalf}}),L=V(()=>{if(typeof e.iconAriaLabel=="string"){const n=e.iconAriaLabel.length!==0?`${e.iconAriaLabel} `:"";return o=>`${n}${o}`}if(Array.isArray(e.iconAriaLabel)===!0){const n=e.iconAriaLabel.length;if(n>0)return o=>e.iconAriaLabel[Math.min(o,n)-1]}return(n,o)=>`${o} ${n}`}),A=V(()=>{const n=[],o=C.value,v=Math.ceil(e.modelValue),b=y.value===!0?0:null,x=e.iconHalf===void 0||v===e.modelValue?-1:v;for(let t=1;t<=e.max;t++){const l=s.value===0&&e.modelValue>=t||s.value>0&&s.value>=t,i=x===t&&s.value<t,h=s.value>0&&(i===!0?v:e.modelValue)>=t&&s.value<t,K=i===!0?t<=o.halfColorLen?e.colorHalf[t-1]:o.halfColor:o.selColor!==void 0&&l===!0?t<=o.selColorLen?e.colorSelected[t-1]:o.selColor:t<=o.colorLen?e.color[t-1]:o.color,Y=(i===!0?t<=o.halfIconLen?e.iconHalf[t-1]:o.halfIcon:o.selIcon!==void 0&&(l===!0||h===!0)?t<=o.selIconLen?e.iconSelected[t-1]:o.selIcon:t<=o.iconLen?e.icon[t-1]:o.icon)||q.iconSet.rating.icon;n.push({name:(i===!0?t<=o.halfIconLen?e.iconHalf[t-1]:o.halfIcon:o.selIcon!==void 0&&(l===!0||h===!0)?t<=o.selIconLen?e.iconSelected[t-1]:o.selIcon:t<=o.iconLen?e.icon[t-1]:o.icon)||q.iconSet.rating.icon,attrs:{tabindex:b,role:"radio","aria-checked":e.modelValue===t?"true":"false","aria-label":L.value(t,Y)},iconClass:"q-rating__icon"+(l===!0||i===!0?" q-rating__icon--active":"")+(h===!0?" q-rating__icon--exselected":"")+(s.value===t?" q-rating__icon--hovered":"")+(K!==void 0?` text-${K}`:"")})}return n}),m=V(()=>{const n={role:"radiogroup"};return e.disable===!0&&(n["aria-disabled"]="true"),e.readonly===!0&&(n["aria-readonly"]="true"),n});function w(n){if(y.value===!0){const o=ge(parseInt(n,10),1,parseInt(e.max,10)),v=e.noReset!==!0&&e.modelValue===o?0:o;v!==e.modelValue&&Q("update:modelValue",v),s.value=0}}function M(n){y.value===!0&&(s.value=n)}function D(n,o){switch(n.keyCode){case 13:case 32:return w(o),z(n);case 37:case 40:return d[`rt${o-1}`]&&d[`rt${o-1}`].focus(),z(n);case 39:case 38:return d[`rt${o+1}`]&&d[`rt${o+1}`].focus(),z(n)}}function B(){s.value=0}return ne(()=>{d={}}),()=>{const n=[];return A.value.forEach(({iconClass:o,name:v,attrs:b},x)=>{const t=x+1;n.push(O("div",{key:t,ref:l=>{d[`rt${t}`]=l},class:"q-rating__icon-container flex flex-center",...b,onClick(){w(t)},onMouseover(){M(t)},onMouseout:B,onFocus(){M(t)},onBlur:B,onKeyup(l){D(l,t)}},ie($[`tip-${t}`],[O(E,{class:o,name:v})])))}),e.name!==void 0&&e.disable!==!0&&_(n,"push"),O("div",{class:S.value,style:N.value,...m.value},n)}}}),Ve={class:"row q-col-gutter-lg"},_e={class:"col-12 col-md-4"},Se={class:"col-12 col-md-8"},Ae={key:0,class:"text-center q-mt-xl"},ke={class:"row no-wrap"},Ie={class:"col-4"},qe={class:"col-8"},Ce={class:"row items-center"},Le={class:"col"},we={class:"text-h5"},He={class:"text-subtitle2 text-grey-7"},$e={class:"col-auto"},Qe={class:"row items-center"},Me={class:"q-ml-sm text-weight-bold"},De={class:"q-mt-md"},Be={class:"text-h4 text-weight-bold text-primary"},Ue={class:"text-body2 text-positive q-mt-sm"},Pe={class:"text-caption text-grey-6"},Ne={key:0,class:"text-body2 q-mt-sm"},Re={class:"text-h6"},Fe={class:"text-h6 text-primary q-mt-md"},il={__name:"HotelsPage",setup(e){const $=be(),Q=se(),q=ye(),{hotels:N,user:R}=xe(q),_=g(null),s=g(""),d=g(""),y=g(2),S=g({min:0,max:500}),C=g(!1),L=g(!1),A=g(!1),m=g(null),w=new Date().toISOString().split("T")[0],M=["Moscow","St. Petersburg","Sochi"],D=V(()=>{if(!C.value)return[];let t=N.value;return _.value&&(t=t.filter(l=>l.city===_.value)),t=t.filter(l=>l.price>=S.value.min&&l.price<=S.value.max),t});function B(){C.value=!0}function n(){if(!s.value||!d.value)return 0;const t=new Date(s.value),i=new Date(d.value)-t,h=Math.ceil(i/(1e3*60*60*24));return Math.max(0,h)}function o(t){return s.value&&d.value&&t.rooms>0}function v(t){m.value=t,L.value=!0}function b(t){if(!R.value.isLoggedIn){$.notify({type:"warning",message:"Для бронирования необходимо войти в систему",position:"top"}),Q.push("/login");return}m.value=t,A.value=!0}function x(){if(!m.value)return;const t={hotelId:m.value.id,hotelName:m.value.name,checkIn:s.value,checkOut:d.value,guests:y.value,totalPrice:m.value.price*Math.max(n(),1)};q.bookHotel(t),$.notify({type:"positive",message:"Бронирование успешно создано!",position:"top"}),A.value=!1,Q.push("/bookings")}return(t,l)=>(H(),re(de,{class:"q-pa-lg"},{default:c(()=>[a("div",Ve,[a("div",_e,[r(P,null,{default:c(()=>[r(I,null,{default:c(()=>[l[7]||(l[7]=a("h6",null,"Поиск отелей",-1)),r(Z,{modelValue:_.value,"onUpdate:modelValue":l[0]||(l[0]=i=>_.value=i),options:M,label:"Город",clearable:"",class:"q-mb-md"},null,8,["modelValue"]),r(F,{modelValue:s.value,"onUpdate:modelValue":l[1]||(l[1]=i=>s.value=i),type:"date",label:"Дата заезда",class:"q-mb-md",min:j(w)},null,8,["modelValue","min"]),r(F,{modelValue:d.value,"onUpdate:modelValue":l[2]||(l[2]=i=>d.value=i),type:"date",label:"Дата выезда",class:"q-mb-md",min:s.value||j(w)},null,8,["modelValue","min"]),r(F,{modelValue:y.value,"onUpdate:modelValue":l[3]||(l[3]=i=>y.value=i),modelModifiers:{number:!0},type:"number",label:"Количество гостей",min:1,max:10,class:"q-mb-md"},null,8,["modelValue"]),r(p,{modelValue:S.value,"onUpdate:modelValue":l[4]||(l[4]=i=>S.value=i),min:0,max:500,step:25,label:"","label-always":"",class:"q-mb-md"},null,8,["modelValue"]),r(k,{color:"primary",label:"Найти отели",icon:"search",onClick:B,class:"full-width"})]),_:1,__:[7]})]),_:1})]),a("div",Se,[l[12]||(l[12]=a("h4",{class:"q-my-none q-mb-lg"},"Доступные отели",-1)),D.value.length===0&&C.value?(H(),U("div",Ae,[r(E,{name:"hotel_class",size:"4rem",color:"grey-5"}),l[8]||(l[8]=a("p",{class:"text-h6 text-grey-6 q-mt-md"}," Отели не найдены ",-1))])):J("",!0),(H(!0),U(ue,null,ce(D.value,i=>(H(),U("div",{key:i.id,class:"q-mb-lg"},[r(P,null,{default:c(()=>[a("div",ke,[a("div",Ie,[r(ee,{src:i.image,style:{height:"250px"},class:"bg-grey-3"},null,8,["src"])]),a("div",qe,[r(I,null,{default:c(()=>[a("div",Ce,[a("div",Le,[a("div",we,u(i.name),1),a("div",He,u(i.city),1)]),a("div",$e,[a("div",Qe,[r(he,{modelValue:i.rating,"onUpdate:modelValue":h=>i.rating=h,readonly:"",color:"orange",size:"sm"},null,8,["modelValue","onUpdate:modelValue"]),a("span",Me,u(i.rating),1)])])]),a("div",De,[a("div",Be,[f(" $"+u(i.price)+" ",1),l[9]||(l[9]=a("span",{class:"text-body2 text-grey-7"},"/ ночь",-1))]),a("div",Ue,[r(E,{name:"check_circle",size:"sm"}),l[10]||(l[10]=f(" Доступно для бронирования ",-1))]),a("div",Pe," Свободных номеров: "+u(i.rooms),1),s.value&&d.value?(H(),U("div",Ne,[f(" Всего ночей: "+u(n())+" ",1),l[11]||(l[11]=a("br",null,null,-1)),f(" Общая стоимость: $"+u(i.price*Math.max(n(),1)),1)])):J("",!0)])]),_:2},1024),r(T,{align:"right",class:"q-pa-md"},{default:c(()=>[r(k,{flat:"",color:"grey-7",label:"Подробнее",onClick:h=>v(i)},null,8,["onClick"]),r(k,{color:"primary",label:"Забронировать",onClick:h=>b(i),disable:!o(i)},null,8,["onClick","disable"])]),_:2},1024)])])]),_:2},1024)]))),128))])]),r(W,{modelValue:L.value,"onUpdate:modelValue":l[5]||(l[5]=i=>L.value=i)},{default:c(()=>[r(P,{style:{"min-width":"400px"}},{default:c(()=>[r(I,null,{default:c(()=>[a("div",Re,u(m.value?.name),1)]),_:1}),r(I,null,{default:c(()=>[l[16]||(l[16]=a("p",null,"Детальная информация об отеле будет здесь...",-1)),a("p",null,[l[13]||(l[13]=a("strong",null,"Город:",-1)),f(" "+u(m.value?.city),1)]),a("p",null,[l[14]||(l[14]=a("strong",null,"Рейтинг:",-1)),f(" "+u(m.value?.rating)+"/5",1)]),a("p",null,[l[15]||(l[15]=a("strong",null,"Цена за ночь:",-1)),f(" $"+u(m.value?.price),1)])]),_:1,__:[16]}),r(T,{align:"right"},{default:c(()=>[G(r(k,{flat:"",label:"Закрыть",color:"primary"},null,512),[[X]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(W,{modelValue:A.value,"onUpdate:modelValue":l[6]||(l[6]=i=>A.value=i)},{default:c(()=>[r(P,{style:{"min-width":"400px"}},{default:c(()=>[r(I,null,{default:c(()=>l[17]||(l[17]=[a("div",{class:"text-h6"},"Подтверждение бронирования",-1)])),_:1,__:[17]}),r(I,null,{default:c(()=>[a("div",null,[l[18]||(l[18]=a("strong",null,"Отель:",-1)),f(" "+u(m.value?.name),1)]),a("div",null,[l[19]||(l[19]=a("strong",null,"Даты:",-1)),f(" "+u(s.value)+" - "+u(d.value),1)]),a("div",null,[l[20]||(l[20]=a("strong",null,"Гостей:",-1)),f(" "+u(y.value),1)]),a("div",null,[l[21]||(l[21]=a("strong",null,"Ночей:",-1)),f(" "+u(n()),1)]),a("div",Fe,[a("strong",null,"Итого: $"+u(m.value?m.value.price*Math.max(n(),1):0),1)])]),_:1}),r(T,{align:"right"},{default:c(()=>[G(r(k,{flat:"",label:"Отмена",color:"grey"},null,512),[[X]]),r(k,{label:"Подтвердить",color:"primary",onClick:x})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{il as default};
