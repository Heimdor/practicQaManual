import{r as y,a as E,C as x,D as c,E as i,F,N as e,H as l,L as g,K as h,Q as u,f as d,J as o,M as H,P as j,I as r,O as J,v as N}from"./index-DwtXEeEE.js";import{Q as K}from"./QChip-BlzJDsgu.js";import{Q as G}from"./QSeparator-BDotjxYQ.js";import{Q as W,a as q,b as m}from"./QPage-BKmakszr.js";import{Q as w}from"./QCardActions-C7c0BvX-.js";import{Q as I}from"./QDialog-1wfPclpf.js";import{C as S}from"./ClosePopup-CijrAyJj.js";import{b as X}from"./main-CmGCYb36.js";import{u as Y}from"./use-quasar-ChbBNSRg.js";import{s as Z}from"./pinia-DeEn6jnt.js";import{_ as tt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./use-prevent-scroll-dlfsZIDd.js";import"./focus-manager-BJWzFvJg.js";const et={class:"row justify-center"},lt={class:"col-12 col-md-10"},st={key:0,class:"text-center q-mt-xl"},ot={key:1,class:"text-center q-mt-xl"},nt={key:2},at={class:"row q-mb-md"},rt={class:"col"},it={class:"text-subtitle1"},ut={class:"col-auto"},dt={class:"q-gutter-md"},ct={class:"row"},mt={class:"col"},vt={class:"text-h6"},ft={class:"text-subtitle2 text-grey-7"},gt={class:"col-auto"},pt={class:"row q-col-gutter-md"},_t={class:"col-12 col-md-6"},yt={class:"text-body2"},xt={class:"text-body2 q-mt-sm"},ht={class:"text-body2 q-mt-sm"},qt={class:"col-12 col-md-6"},wt={class:"text-body2"},Ct={class:"text-body2 q-mt-sm"},kt={class:"text-body2 q-mt-sm text-grey-6"},bt={class:"q-gutter-sm"},Dt={__name:"BookingsPage",setup(Qt){const L=Y(),C=F(),k=X(),{bookings:p,user:P}=Z(k),_=y(!1),v=y(!1),n=y(null),T=E(()=>[...p.value].sort((a,t)=>new Date(t.createdAt)-new Date(a.createdAt)));function $(){C.push("/login")}function b(){C.push("/hotels")}function D(a,t){const s=new Date(a),U=new Date(t)-s,z=Math.ceil(U/(1e3*60*60*24));return Math.max(0,z)}function f(a){return new Date(a).toLocaleDateString("ru-RU",{year:"numeric",month:"long",day:"numeric"})}function Q(a){return new Date(a).toLocaleString("ru-RU",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function A(a){switch(a){case"confirmed":return"positive";case"cancelled":return"negative";case"pending":return"warning";default:return"grey"}}function B(a){switch(a){case"confirmed":return"Подтверждено";case"cancelled":return"Отменено";case"pending":return"Ожидает подтверждения";default:return a}}function O(a){n.value=a,_.value=!0}function M(a){n.value=a,v.value=!0}function R(){n.value&&(k.cancelBooking(n.value.id),L.notify({type:"info",message:`Бронирование #${n.value.id} отменено`,position:"top"}),v.value=!1,n.value=null)}return(a,t)=>(c(),x(W,{class:"q-pa-lg"},{default:i(()=>[e("div",et,[e("div",lt,[t[9]||(t[9]=e("h4",{class:"q-mb-lg"},"Мои бронирования",-1)),h(P).isLoggedIn?h(p).length===0?(c(),g("div",ot,[l(u,{name:"hotel_class",size:"4rem",color:"grey-5"}),t[3]||(t[3]=e("p",{class:"text-h6 text-grey-6 q-mt-md"}," У вас пока нет бронирований ",-1)),l(d,{color:"primary",label:"Забронировать отель",onClick:b})])):(c(),g("div",nt,[e("div",at,[e("div",rt,[e("div",it," Всего бронирований: "+o(h(p).length),1)]),e("div",ut,[l(d,{color:"primary",label:"Забронировать еще",icon:"add",onClick:b})])]),e("div",dt,[(c(!0),g(H,null,j(T.value,s=>(c(),x(q,{key:s.id,class:"booking-card"},{default:i(()=>[l(m,null,{default:i(()=>[e("div",ct,[e("div",mt,[e("div",vt,o(s.hotelName),1),e("div",ft," Бронирование #"+o(s.id),1)]),e("div",gt,[l(K,{color:A(s.status),"text-color":"white",label:B(s.status)},null,8,["color","label"])])]),l(G,{class:"q-my-md"}),e("div",pt,[e("div",_t,[e("div",yt,[l(u,{name:"calendar_today",class:"q-mr-sm"}),t[4]||(t[4]=e("strong",null,"Заезд:",-1)),r(" "+o(f(s.checkIn)),1)]),e("div",xt,[l(u,{name:"calendar_today",class:"q-mr-sm"}),t[5]||(t[5]=e("strong",null,"Выезд:",-1)),r(" "+o(f(s.checkOut)),1)]),e("div",ht,[l(u,{name:"people",class:"q-mr-sm"}),t[6]||(t[6]=e("strong",null,"Гостей:",-1)),r(" "+o(s.guests),1)])]),e("div",qt,[e("div",wt,[l(u,{name:"schedule",class:"q-mr-sm"}),t[7]||(t[7]=e("strong",null,"Ночей:",-1)),r(" "+o(D(s.checkIn,s.checkOut)),1)]),e("div",Ct,[l(u,{name:"attach_money",class:"q-mr-sm"}),t[8]||(t[8]=e("strong",null,"Общая стоимость:",-1)),r(" $"+o(s.totalPrice),1)]),e("div",kt,[l(u,{name:"access_time",class:"q-mr-sm"}),r(" Создано: "+o(Q(s.createdAt)),1)])])])]),_:2},1024),l(w,{align:"right"},{default:i(()=>[l(d,{flat:"",color:"grey-7",label:"Подробнее",onClick:V=>O(s)},null,8,["onClick"]),l(d,{flat:"",color:"negative",label:"Отменить",onClick:V=>M(s),disable:s.status==="cancelled"},null,8,["onClick","disable"])]),_:2},1024)]),_:2},1024))),128))])])):(c(),g("div",st,[l(u,{name:"hotel_class",size:"4rem",color:"grey-5"}),t[2]||(t[2]=e("p",{class:"text-h6 text-grey-6 q-mt-md"}," Войдите в систему для просмотра бронирований ",-1)),l(d,{color:"primary",label:"Войти",onClick:$})]))])]),l(I,{modelValue:_.value,"onUpdate:modelValue":t[0]||(t[0]=s=>_.value=s)},{default:i(()=>[l(q,{style:{"min-width":"400px"}},{default:i(()=>[l(m,null,{default:i(()=>t[10]||(t[10]=[e("div",{class:"text-h6"},"Детали бронирования",-1)])),_:1,__:[10]}),n.value?(c(),x(m,{key:0},{default:i(()=>[e("div",bt,[e("div",null,[t[11]||(t[11]=e("strong",null,"Отель:",-1)),r(" "+o(n.value.hotelName),1)]),e("div",null,[t[12]||(t[12]=e("strong",null,"Номер бронирования:",-1)),r(" #"+o(n.value.id),1)]),e("div",null,[t[13]||(t[13]=e("strong",null,"Статус:",-1)),r(" "+o(B(n.value.status)),1)]),e("div",null,[t[14]||(t[14]=e("strong",null,"Заезд:",-1)),r(" "+o(f(n.value.checkIn)),1)]),e("div",null,[t[15]||(t[15]=e("strong",null,"Выезд:",-1)),r(" "+o(f(n.value.checkOut)),1)]),e("div",null,[t[16]||(t[16]=e("strong",null,"Количество гостей:",-1)),r(" "+o(n.value.guests),1)]),e("div",null,[t[17]||(t[17]=e("strong",null,"Ночей:",-1)),r(" "+o(D(n.value.checkIn,n.value.checkOut)),1)]),e("div",null,[t[18]||(t[18]=e("strong",null,"Общая стоимость:",-1)),r(" $"+o(n.value.totalPrice),1)]),e("div",null,[t[19]||(t[19]=e("strong",null,"Дата создания:",-1)),r(" "+o(Q(n.value.createdAt)),1)])])]),_:1})):J("",!0),l(w,{align:"right"},{default:i(()=>[N(l(d,{flat:"",label:"Закрыть",color:"primary"},null,512),[[S]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{modelValue:v.value,"onUpdate:modelValue":t[1]||(t[1]=s=>v.value=s)},{default:i(()=>[l(q,null,{default:i(()=>[l(m,null,{default:i(()=>t[20]||(t[20]=[e("div",{class:"text-h6"},"Подтверждение отмены",-1)])),_:1,__:[20]}),l(m,null,{default:i(()=>[r(" Вы уверены, что хотите отменить бронирование в "+o(n.value?.hotelName)+"? ",1),t[21]||(t[21]=e("br",null,null,-1)),t[22]||(t[22]=e("br",null,null,-1)),t[23]||(t[23]=e("div",{class:"text-body2 text-grey-7"}," Отмена бесплатная за 24 часа до заезда. При более поздней отмене взимается штраф 50%. ",-1))]),_:1,__:[21,22,23]}),l(w,{align:"right"},{default:i(()=>[N(l(d,{flat:"",label:"Нет",color:"grey"},null,512),[[S]]),l(d,{label:"Да, отменить",color:"negative",onClick:R})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},Ut=tt(Dt,[["__scopeId","data-v-537fc0e5"]]);export{Ut as default};
