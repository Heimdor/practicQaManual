import{r as b,A as N,w as S,C,D as f,E as l,F as j,N as e,H as t,L as h,K as g,Q as M,f as s,J as v,I as A,v as O}from"./index-DwtXEeEE.js";import{Q as k}from"./QInput-CAHg_qN-.js";import{Q as R}from"./QForm-B7PInOLQ.js";import{Q as $,a as r,b as i}from"./QPage-BKmakszr.js";import{Q as z}from"./QCardActions-C7c0BvX-.js";import{Q as H}from"./QDialog-1wfPclpf.js";import{C as J}from"./ClosePopup-CijrAyJj.js";import{b as K}from"./main-CmGCYb36.js";import{u as U}from"./use-quasar-ChbBNSRg.js";import{s as G}from"./pinia-DeEn6jnt.js";import"./use-key-composition-ByB1cnyR.js";import"./use-id-DNP9DObu.js";import"./focus-manager-BJWzFvJg.js";import"./use-prevent-scroll-dlfsZIDd.js";const W={class:"row justify-center"},X={class:"col-12 col-md-8"},Y={key:0,class:"text-center q-mt-xl"},Z={key:1},tt={class:"q-mt-md"},ot={key:1,class:"q-gutter-sm"},et={class:"row q-col-gutter-md q-mb-lg"},lt={class:"col-6 col-md-3"},at={class:"text-h4 text-primary"},st={class:"col-6 col-md-3"},nt={class:"text-h4 text-secondary"},it={class:"col-6 col-md-3"},ut={class:"text-h4 text-accent"},dt={class:"col-6 col-md-3"},rt={class:"text-h4 text-positive"},mt={class:"row q-gutter-md"},Tt={__name:"ProfilePage",setup(ct){const _=U(),m=j(),y=K(),{user:c,cart:Q,cartTotal:V,bookings:q}=G(y),a=b(!1),x=b(!1),p=b(!1),n=N({name:"",email:"",phone:""});S(c,u=>{u.isLoggedIn&&Object.assign(n,{name:u.name,email:u.email,phone:u.phone})},{immediate:!0});function T(){m.push("/login")}function w(){m.push("/shop")}function B(){m.push("/bookings")}function L(){m.push("/cart")}function P(){a.value=!0}function D(){a.value=!1,Object.assign(n,{name:c.value.name,email:c.value.email,phone:c.value.phone})}async function E(){x.value=!0;try{await new Promise(u=>setTimeout(u,1e3)),y.login(n),a.value=!1,_.notify({type:"positive",message:"Профиль успешно обновлен!",position:"top"})}catch{_.notify({type:"negative",message:"Ошибка при сохранении профиля",position:"top"})}finally{x.value=!1}}function I(){p.value=!0}function F(){y.logout(),p.value=!1,_.notify({type:"info",message:"Вы вышли из системы",position:"top"}),m.push("/")}return(u,o)=>(f(),C($,{class:"q-pa-lg"},{default:l(()=>[e("div",W,[e("div",X,[o[11]||(o[11]=e("h4",{class:"q-mb-lg"},"Профиль пользователя",-1)),g(c).isLoggedIn?(f(),h("div",Z,[t(r,{class:"q-mb-lg"},{default:l(()=>[t(i,null,{default:l(()=>[o[5]||(o[5]=e("div",{class:"text-h6 q-mb-md"},"Личная информация",-1)),t(R,{class:"q-gutter-md"},{default:l(()=>[t(k,{modelValue:n.name,"onUpdate:modelValue":o[0]||(o[0]=d=>n.name=d),label:"Имя",readonly:!a.value,outlined:a.value,standout:!a.value},null,8,["modelValue","readonly","outlined","standout"]),t(k,{modelValue:n.email,"onUpdate:modelValue":o[1]||(o[1]=d=>n.email=d),label:"Email",type:"email",readonly:!a.value,outlined:a.value,standout:!a.value},null,8,["modelValue","readonly","outlined","standout"]),t(k,{modelValue:n.phone,"onUpdate:modelValue":o[2]||(o[2]=d=>n.phone=d),label:"Телефон",mask:"# (###) ###-##-##",readonly:!a.value,outlined:a.value,standout:!a.value},null,8,["modelValue","readonly","outlined","standout"]),e("div",tt,[a.value?(f(),h("div",ot,[t(s,{color:"positive",label:"Сохранить",icon:"save",onClick:E,loading:x.value},null,8,["loading"]),t(s,{flat:"",color:"grey",label:"Отмена",onClick:D})])):(f(),C(s,{key:0,color:"primary",label:"Редактировать",icon:"edit",onClick:P}))])]),_:1})]),_:1,__:[5]})]),_:1}),e("div",et,[e("div",lt,[t(r,{class:"text-center"},{default:l(()=>[t(i,null,{default:l(()=>[e("div",at,v(g(Q).length),1),o[6]||(o[6]=e("div",{class:"text-grey-7"},"Товаров в корзине",-1))]),_:1,__:[6]})]),_:1})]),e("div",st,[t(r,{class:"text-center"},{default:l(()=>[t(i,null,{default:l(()=>[e("div",nt,v(g(q).length),1),o[7]||(o[7]=e("div",{class:"text-grey-7"},"Бронирований",-1))]),_:1,__:[7]})]),_:1})]),e("div",it,[t(r,{class:"text-center"},{default:l(()=>[t(i,null,{default:l(()=>[e("div",ut,"$"+v(g(V).toFixed(2)),1),o[8]||(o[8]=e("div",{class:"text-grey-7"},"Сумма в корзине",-1))]),_:1,__:[8]})]),_:1})]),e("div",dt,[t(r,{class:"text-center"},{default:l(()=>[t(i,null,{default:l(()=>[e("div",rt,v(Math.floor(Math.random()*10)),1),o[9]||(o[9]=e("div",{class:"text-grey-7"},"Заказов",-1))]),_:1,__:[9]})]),_:1})])]),t(r,null,{default:l(()=>[t(i,null,{default:l(()=>[o[10]||(o[10]=e("div",{class:"text-h6 q-mb-md"},"Быстрые действия",-1)),e("div",mt,[t(s,{color:"primary",label:"Перейти к покупкам",icon:"store",onClick:w}),t(s,{color:"secondary",label:"Мои бронирования",icon:"hotel",onClick:B}),t(s,{color:"accent",label:"Корзина",icon:"shopping_cart",onClick:L}),t(s,{flat:"",color:"negative",label:"Выйти",icon:"logout",onClick:I})])]),_:1,__:[10]})]),_:1})])):(f(),h("div",Y,[t(M,{name:"account_circle",size:"4rem",color:"grey-5"}),o[4]||(o[4]=e("p",{class:"text-h6 text-grey-6 q-mt-md"}," Войдите в систему для просмотра профиля ",-1)),t(s,{color:"primary",label:"Войти",onClick:T})]))])]),t(H,{modelValue:p.value,"onUpdate:modelValue":o[3]||(o[3]=d=>p.value=d)},{default:l(()=>[t(r,null,{default:l(()=>[t(i,null,{default:l(()=>o[12]||(o[12]=[e("div",{class:"text-h6"},"Подтверждение",-1)])),_:1,__:[12]}),t(i,null,{default:l(()=>o[13]||(o[13]=[A(" Вы уверены, что хотите выйти из системы? ",-1)])),_:1,__:[13]}),t(z,{align:"right"},{default:l(()=>[O(t(s,{flat:"",label:"Отмена",color:"grey"},null,512),[[J]]),t(s,{label:"Выйти",color:"negative",onClick:F})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}};export{Tt as default};
